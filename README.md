# coffee_demo
## 目的
このレポジトリはプログラミング初心者を想定した聴衆に、データ分析プログラミングのコード管理について伝える際のデモンストレーションとして使用するために書かれたものです。
## Data
デモンストレーションの分析として、[Coffee Quality Institute(CQI)](https://ja.coffeeinstitute.org/)が行った、コーヒーの評価に関するデータを使用しています。
`01_data/data`内に含まれる生データは、[こちら](https://github.com/fatih-boyar/coffee-quality-data-CQI)のgithubのレポジトリからダウンロードしたものになっています。

## 分析の概要
このプロジェクトでは主に２つの簡単な分析を実装しています。
### Bayesian Linear Regression
コーヒーに対する評価項目のうち、**Overall**という項目を他の評価項目で説明する線形回帰モデルです。  
一般的な`lm()`関数ではなく、ベイズ流で実装しギブス・サンプラーによってパラメータの推論を実行しています。  
<br>
**説明変数に使用した評価項目**
<dl>
  <dt>Aroma</dt>
  <dd> コーヒーの香り。</dd>
  <dt>Flavor</dt>
  <dd>コーヒーの風味。甘味、苦味、酸味、その他の風味を含む味覚によって評価される。</dd>
  <dt>Aftertaste</dt>
  <dd>コーヒーを飲み込んだ後に口に残る余韻。</dd>
  <dt>Acidity</dt>
  <dd>コーヒーにおける酸味。味の明るさや活気。</dd>
  <dt>Balance</dt>
  <dd>バランス。コーヒーのさまざまな風味成分がうまく調和しているか。</dd>
  <dt>Body</dt>
  <dd>口に含んだときのコーヒーの厚みや粘度。</dd>
</dl> 

アウトプットとして、`04_report`で以下のような各特徴の回帰係数の事後分布を出力しています。  
<img src="/04_report/result/beta_posterior_1.png" width=9000 height=600>


### 主成分分析
線形回帰で説明変数に用いた評価項目を用いて、主成分分析を行います。  
`04_report`で各コーヒーの特徴量を２次元に縮約した形でプロットしています。

<img src="/04_report/result/2d_PCA_point.png" width=900 height=600>

## フォルダ構造の説明
`01_data`など数字付きの階層の浅いフォルダは、生データ->前処理->分析->レポートのデータ分析を行う上で必要なステップの順に並べられています。
それぞれ、`code`と`data` or `result`フォルダを含みます。 `code`フォルダにはその階層で行う処理に必要なコードが配置され、`data`または`result`にはその階層での処理の結果であるデータ、分析のアウトプットが配置されます。
### 01_data
基本的に生データを格納するためのフォルダです。シミュレーションを行う場合、データを生成するためのコードはこのフォルダ内で書くことが多いです。

### 02_build
データの前処理を行う階層です。`code`には生データを分析可能な形に加工するために必要なコードを書き、`data`にはそのアウトプットの前処理済みのデータが配置されるようにします。

### 03_analyze
データの分析を行うための階層です。MCMCなどパラメータの推定のためのアルゴリズムを実行するためのコードは、他のコードと比較して読みにくくなることが多いので別のスクリプトに分けて実行時に呼び出す形にすることが多いです。
今回は`analyze.R`という１つのスクリプトで２つの分析を行っていますが、コードが膨らむようなら`code`内で手法ごとに分割しても良いと思います。

### 04_report
プロットや表の作成を行う階層です。`code`でプロットを作生するコードを書き、`result`にそのアウトプットを保存しています。

